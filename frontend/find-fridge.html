<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Find a Fridge - Community Fridge</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #3a9561;
      --secondary-color: #fcfcf7;
      --accent-color: #e67e22;
      --text-color: #333333;
      --light-gray: #f8f8f8;
      --white: #ffffff;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--secondary-color);
      color: var(--text-color);
      line-height: 1.6;
    }
    
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* Header Styles */
    header {
      background-color: var(--white);
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      padding: 20px 0;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 1000;
    }
    
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: var(--primary-color);
      font-weight: bold;
      font-size: 1.5rem;
    }
    
    .logo i {
      margin-right: 10px;
      font-size: 1.2em;
    }
    
    nav ul {
      display: flex;
      list-style: none;
    }
    
    nav li {
      margin-left: 30px;
    }
    
    nav a {
      text-decoration: none;
      color: var(--text-color);
      font-weight: 500;
      transition: color 0.3s ease;
      position: relative;
    }
    
    nav a:hover {
      color: var(--primary-color);
    }
    
    nav a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -5px;
      left: 0;
      background-color: var(--primary-color);
      transition: width 0.3s ease;
    }
    
    nav a:hover::after {
      width: 100%;
    }
    
    nav a.active {
      color: var(--primary-color);
    }
    
    nav a.active::after {
      width: 100%;
    }
    
    .back-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .back-btn:hover {
      background-color: #2d7b4b;
    }
    
    /* Main Content */
    .main-content {
      margin-top: 76px;
      padding: 40px 0;
    }
    
    .page-title {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .page-title h1 {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 15px;
    }
    
    .page-title p {
      font-size: 1.1rem;
      color: var(--text-color);
      max-width: 700px;
      margin: 0 auto;
    }
    
    /* Map Section */
    .map-container {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      margin-bottom: 40px;
    }
    
    .map-wrapper {
      flex: 1;
      min-width: 300px;
      height: 500px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    #map {
      width: 100%;
      height: 100%;
    }
    
    .fridge-list {
      flex: 0 0 350px;
      background-color: var(--white);
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      max-height: 500px;
      overflow-y: auto;
    }
    
    .fridge-list h2 {
      font-size: 1.5rem;
      color: var(--primary-color);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    
    .fridge-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    
    .fridge-item:hover {
      background-color: var(--light-gray);
    }
    
    .fridge-item h3 {
      font-size: 1.1rem;
      margin-bottom: 5px;
      color: var(--text-color);
    }
    
    .fridge-item p {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 10px;
    }
    
    .fridge-item .fridge-actions {
      display: flex;
      gap: 10px;
    }
    
    .fridge-item .fridge-actions button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: background-color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .fridge-item .fridge-actions button:hover {
      background-color: #2d7b4b;
    }
    
    /* Weather Widget */
    .weather-widget {
      background-color: var(--white);
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      margin-bottom: 40px;
    }
    
    .weather-widget h2 {
      font-size: 1.5rem;
      color: var(--primary-color);
      margin-bottom: 20px;
    }
    
    .weather-content {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .weather-icon {
      font-size: 3rem;
      color: var(--accent-color);
    }
    
    .weather-details h3 {
      font-size: 1.3rem;
      margin-bottom: 5px;
    }
    
    .weather-details p {
      font-size: 1rem;
      color: #666;
    }
    
    /* Footer */
    footer {
      background-color: var(--primary-color);
      color: white;
      padding: 40px 0 20px;
    }
    
    .footer-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 40px;
      margin-bottom: 30px;
    }
    
    .footer-logo {
      display: flex;
      align-items: center;
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .footer-logo i {
      margin-right: 10px;
    }
    
    .footer-links h3 {
      font-size: 1.2rem;
      margin-bottom: 20px;
    }
    
    .footer-links ul {
      list-style: none;
    }
    
    .footer-links li {
      margin-bottom: 10px;
    }
    
    .footer-links a {
      color: white;
      text-decoration: none;
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }
    
    .footer-links a:hover {
      opacity: 1;
    }
    
    .copyright {
      text-align: center;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .header-container {
        flex-direction: column;
      }
      
      nav ul {
        margin-top: 20px;
      }
      
      nav li {
        margin: 0 10px;
      }
      
      .back-btn {
        margin-top: 20px;
      }
      
      .main-content {
        margin-top: 160px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container header-container">
      <a href="/" class="logo">
        <i class="fas fa-utensils"></i>
        Community Fridge
      </a>
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/find-fridge" class="active">Find a Fridge</a></li>
          <li><a href="/contact">Contact</a></li>
        </ul>
      </nav>
      <button class="back-btn" onclick="window.history.back()">
        <i class="fas fa-arrow-left"></i> Back
      </button>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <div class="page-title">
        <h1>Find a London Community Fridge</h1>
        <p>Locate the nearest community fridge in Camden, Brixton, and Hackney, London. Check current weather conditions to plan your visit.</p>
      </div>
      
      <div class="weather-widget">
        <h2>Current Weather</h2>
        <div class="weather-content">
          <div class="weather-icon" id="weather-icon">
            <i class="fas fa-cloud-sun"></i>
          </div>
          <div class="weather-details">
            <h3 id="weather-temp">Loading weather data...</h3>
            <p id="weather-desc"></p>
          </div>
        </div>
      </div>
      
      <div class="map-container">
        <div class="map-wrapper">
          <div id="map"></div>
        </div>
        
        <div class="fridge-list">
          <h2>Nearby Fridges</h2>
          <div id="fridges-container">
            <!-- Fridge items will be added here dynamically -->
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container footer-container">
      <div class="footer-about">
        <div class="footer-logo">
          <i class="fas fa-utensils"></i> Community Fridge
        </div>
        <p>Connecting our community through food sharing.</p>
      </div>
      
      <div class="footer-links">
        <h3>Quick Links</h3>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/contact">Contact</a></li>
        </ul>
      </div>
      
      <div class="footer-links">
        <h3>Get Involved</h3>
        <ul>
          <li><a href="/login">Sign Up</a></li>
          <li><a href="/login">Volunteer</a></li>
          <li><a href="/login">Donate</a></li>
        </ul>
      </div>
    </div>
    
    <div class="container copyright">
      <p>&copy; 2025 Community Fridge. All rights reserved.</p>
    </div>
  </footer>

  <!-- Google Maps API -->
  <script>
    // London community fridge locations in Camden, Brixton, and Hackney
    const fridges = [
      {
        id: 1,
        name: "Camden Community Fridge",
        address: "5 Pancras Square, Kings Cross, London N1C 4AG",
        lat: 51.5343,
        lng: -0.1254,
        status: "Open 10AM-4PM"
      },
      {
        id: 2,
        name: "Brixton Community Fridge",
        address: "49 Brixton Station Road, London SW9 8PQ",
        lat: 51.4626,
        lng: -0.1147,
        status: "Open 10AM-4PM"
      },
      {
        id: 3,
        name: "Hackney Central Fridge",
        address: "1 Reading Lane, London E8 1GQ",
        lat: 51.5454,
        lng: -0.0549,
        status: "Open 10AM-4PM"
      }
    ];

    let map;
    let markers = [];
    
    // Initialize Google Maps
    function initMap() {
      // Create map centered on London
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 51.5074, lng: -0.1278 }, // Center of London
        zoom: 11, // Zoom out a bit to show all neighborhoods
        styles: [
          {
            featureType: "poi",
            elementType: "labels",
            stylers: [{ visibility: "off" }]
          }
        ]
      });
      
      // Try to get user's location
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            
            // Center map on user's location
            map.setCenter(userLocation);
            
            // Add user marker
            new google.maps.Marker({
              position: userLocation,
              map: map,
              icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 10,
                fillColor: "#4285F4",
                fillOpacity: 1,
                strokeColor: "#FFFFFF",
                strokeWeight: 2
              },
              title: "Your Location"
            });
            
            // Get weather for user location
            getWeather(position.coords.latitude, position.coords.longitude);
          },
          () => {
            // If user denies location permission
            console.log("User denied geolocation");
            // Use default weather location
            getWeather(51.505, -0.09);
          }
        );
      } else {
        // Browser doesn't support geolocation
        console.log("Browser doesn't support geolocation");
        // Use default weather location
        getWeather(51.505, -0.09);
      }
      
      // Add fridge markers to map
      addFridgeMarkers();
      
      // Populate fridge list
      populateFridgeList();
    }
    
    // Add fridge markers to the map
    function addFridgeMarkers() {
      fridges.forEach(fridge => {
        const marker = new google.maps.Marker({
          position: { lat: fridge.lat, lng: fridge.lng },
          map: map,
          title: fridge.name,
          icon: {
            url: "https://maps.google.com/mapfiles/ms/icons/green-dot.png"
          }
        });
        
        // Add info window
        const infoWindow = new google.maps.InfoWindow({
          content: `
            <div style="padding: 10px; max-width: 200px;">
              <h3 style="margin-top: 0; color: #3a9561;">${fridge.name}</h3>
              <p>${fridge.address}</p>
              <p><strong>Status:</strong> ${fridge.status}</p>
              <button onclick="getDirections(${fridge.lat}, ${fridge.lng})" 
                      style="background-color: #3a9561; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                Get Directions
              </button>
            </div>
          `
        });
        
        marker.addListener("click", () => {
          infoWindow.open(map, marker);
        });
        
        markers.push({ marker, fridge });
      });
    }
    
    // Populate the fridge list
    function populateFridgeList() {
      const fridgesContainer = document.getElementById("fridges-container");
      
      fridges.forEach(fridge => {
        const fridgeItem = document.createElement("div");
        fridgeItem.className = "fridge-item";
        fridgeItem.innerHTML = `
          <h3>${fridge.name}</h3>
          <p>${fridge.address}</p>
          <p><strong>Status:</strong> ${fridge.status}</p>
          <div class="fridge-actions">
            <button onclick="centerMapOnFridge(${fridge.id})">
              <i class="fas fa-map-marker-alt"></i> View on Map
            </button>
            <button onclick="getDirections(${fridge.lat}, ${fridge.lng})">
              <i class="fas fa-directions"></i> Directions
            </button>
          </div>
        `;
        
        fridgesContainer.appendChild(fridgeItem);
      });
    }
    
    // Center map on selected fridge
    function centerMapOnFridge(fridgeId) {
      const fridgeMarker = markers.find(m => m.fridge.id === fridgeId);
      
      if (fridgeMarker) {
        map.setCenter(fridgeMarker.marker.getPosition());
        map.setZoom(15);
        
        // Trigger marker click to show info window
        google.maps.event.trigger(fridgeMarker.marker, 'click');
      }
    }
    
    // Get directions to fridge
    function getDirections(lat, lng) {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const userLocation = `${position.coords.latitude},${position.coords.longitude}`;
            const fridgeLocation = `${lat},${lng}`;
            
            // Open Google Maps directions in a new tab
            window.open(`https://www.google.com/maps/dir/${userLocation}/${fridgeLocation}`, '_blank');
          },
          () => {
            // If user denies location permission, just open the fridge location
            window.open(`https://www.google.com/maps/search/?api=1&query=${lat},${lng}`, '_blank');
          }
        );
      } else {
        // Browser doesn't support geolocation, just open the fridge location
        window.open(`https://www.google.com/maps/search/?api=1&query=${lat},${lng}`, '_blank');
      }
    }
    
    // Get weather data from OpenWeatherMap API
    function getWeather(lat, lng) {
      const apiKey = '5f472b7acba333cd8a035ea85a0d4d4c'; // Free OpenWeatherMap API key for demo purposes
      const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&units=metric&appid=${apiKey}`;
      
      // Use actual API call
      fetch(weatherUrl)
        .then(response => response.json())
        .then(data => {
          updateWeatherUI(data);
        })
        .catch(error => {
          console.error('Error fetching weather data:', error);
          document.getElementById('weather-temp').textContent = 'Weather data unavailable';
          
          // Fallback to mock data if API call fails
          const mockWeatherData = {
            main: {
              temp: 18
            },
            weather: [
              {
                main: "Clouds",
                description: "scattered clouds"
              }
            ]
          };
          
          updateWeatherUI(mockWeatherData);
        });
    }
    
    // Update weather UI with data
    function updateWeatherUI(data) {
      const weatherTemp = document.getElementById('weather-temp');
      const weatherDesc = document.getElementById('weather-desc');
      const weatherIcon = document.getElementById('weather-icon');
      
      weatherTemp.textContent = `${Math.round(data.main.temp)}Â°C`;
      weatherDesc.textContent = data.weather[0].description;
      
      // Update icon based on weather condition
      let iconClass = 'fa-cloud-sun';
      
      switch(data.weather[0].main) {
        case 'Clear':
          iconClass = 'fa-sun';
          break;
        case 'Clouds':
          iconClass = 'fa-cloud';
          break;
        case 'Rain':
        case 'Drizzle':
          iconClass = 'fa-cloud-rain';
          break;
        case 'Thunderstorm':
          iconClass = 'fa-bolt';
          break;
        case 'Snow':
          iconClass = 'fa-snowflake';
          break;
        case 'Mist':
        case 'Fog':
          iconClass = 'fa-smog';
          break;
      }
      
      weatherIcon.innerHTML = `<i class="fas ${iconClass}"></i>`;
    }
  </script>
  
  <!-- Google Maps API with key -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAKuMAxltNr9B7M2bDvulbg6jjZzoKHWro&callback=initMap" async defer></script>
</body>
</html>
